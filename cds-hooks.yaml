swagger: '2.0'

################################################################################
#                              API Information                                 #
################################################################################
info:
  version: '1.0'
  title: CDS Hooks REST API
host: cds-service-example.herokuapp.com
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json

################################################################################
#                                           Paths                              #
################################################################################
paths:
  /.well-known/cds-services:
    get:
      description: Get a description of all CDS services offered by this CDS Provider
      responses:
        200:
          description: Success (includes CDS service metadata)
          schema:
            $ref: '#/definitions/CDS Service Information'

  /cds-services/{id}:
    post:
      description: Invoke a CDS service offered by this CDS Provider
      parameters:
        - name: id
          in: path
          description: The id of this CDS service
          required: true
          type: string
        - name: request
          in: body
          description: Body of CDS service request
          required: true
          schema:
            $ref: '#/definitions/CDS Request'
      responses:
        200:
          description: Success (includes CDS Cards and Decisions)
          schema:
            $ref: '#/definitions/CDS Response'

  /cds-services/{id}/analytics/{uuid}:
    post:
      description: Creates an analytics event for this service to indicate the user engaged with the event identified by the given UUID
      parameters:
        - name: id
          in: path
          description: The id of this CDS service
          required: true
          type: string
        - name: uuid
          in: path
          description: The UUID of the event (for example, a suggestion)
          required: true
          type: string
      responses:
        200:
          description: Success

################################################################################
#                                 Definitions                                  #
################################################################################
definitions:
  CDS Service Information:
    type: object
    properties:
      services:
        type: array
        items:
           $ref: '#/definitions/CDS Service'

  CDS Service:
    type: object
    properties:
      id:
        type: string
      hook:
        $ref: '#/definitions/HookCoding'
      name:
        type: string
      description:
        type: string
      prefetch:
        $ref: '#/definitions/Prefetch'

  CDS Request:
    type: object
    properties:
      hook:
        $ref: '#/definitions/Hook'
      hookInstance:
        type: string
        format: uuid
      fhirServer:
        type: string
        format: url
      oauth:
        type: object
      redirect:
        type: string
      user:
        type: object
      patient:
        type: object
      encounter:
        type: object
      context:
        type: array
        items:
          type: object
      prefetch:
        type: object

  HookCoding:
    type: object
    properties:
      system:
        type: string
      code:
        type: string

  CDS Response:
    type: object
    properties:
      cards:
        type: array
        items:
          $ref: '#/definitions/Card'
      decisions:
        type: object

  Card:
    type: object
    properties:
      summary:
        type: string
      detail:
        type: string
      indicator:
        type: string
        enum:
          - success
          - info
          - warning
          - hard-stop
      source:
        $ref: '#/definitions/Source'
      suggestions:
        type: array
        items:
          $ref: '#/definitions/Suggestion'
      links:
        type: array
        items:
          $ref: '#/definitions/Link'

  Hook:
    type: string
    enum:
      - patient-view
      - medication-prescribe
      - order-review

  Source:
    type: object
    properties:
      name:
        type: string
      url:
        type: string
        format: url

  Link:
    type: object
    properties:
      label:
        type: string
      url:
        type: string
        format: url

  Suggestion:
    type: object
    properties:
      label:
        type: string
      create:
        type: array
        items:
          type: object
      delete:
        type: array
        items:
          type: object

  Prefetch:
    type: object
    additionalProperties:
      type: string
